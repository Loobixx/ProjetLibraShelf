{% extends 'base.html.twig' %}

{% block title %}{{ ouvrage.titre }}{% endblock %}

{% block body %}
    <div class="container mt-4 mb-5">

        <a href="{{ path('app_catalog_index') }}" class="btn btn-link text-decoration-none text-secondary mb-4 ps-0">
            <i class="bi bi-arrow-left me-2"></i>Retour au catalogue
        </a>

        <div class="row g-5">

            {# === COLONNE GAUCHE : ACTION (RÉSERVER OU FILE D'ATTENTE) === #}
            <div class="col-md-4">

                <div class="card border-0 shadow-sm rounded-4 p-4 text-center bg-white">
                    <h5 class="fw-bold mb-3">Disponibilité</h5>

                    {% if ouvrage.isDisponible() %}
                        {# CAS 1 : DISPONIBLE (Vert) #}
                        <div class="mb-4">
                        <span class="badge bg-success bg-opacity-10 text-success fs-6 px-3 py-2 rounded-pill border border-success">
                            <i class="bi bi-check-circle-fill me-2"></i>Disponible
                        </span>
                        </div>
                        <a href="{{ path('app_catalog_reserver', {'id': ouvrage.id}) }}" class="btn btn-primary btn-lg w-100 rounded-pill shadow-sm fw-bold">
                            Emprunter maintenant
                        </a>
                        <small class="text-muted d-block mt-3">
                            <i class="bi bi-info-circle me-1"></i> À retirer sous 48h
                        </small>

                    {% else %}
                        {# CAS 2 : INDISPONIBLE -> FILE D'ATTENTE (Orange) #}
                        <div class="mb-4">
                        <span class="badge bg-warning bg-opacity-10 text-dark fs-6 px-3 py-2 rounded-pill border border-warning">
                            <i class="bi bi-hourglass-split me-2"></i>Momentanément indisponible
                        </span>
                        </div>

                        <a href="{{ path('app_catalog_reserver', {'id': ouvrage.id}) }}" class="btn btn-warning btn-lg w-100 rounded-pill shadow-sm fw-bold text-dark">
                            Rejoindre la file d'attente
                        </a>

                        <small class="text-muted d-block mt-3">
                            <i class="bi bi-bell me-1"></i> Vous serez notifié dès qu'un exemplaire se libère.
                        </small>
                    {% endif %}
                </div>
            </div>

            {# === COLONNE DROITE : CONTENU DÉTAILLÉ === #}
            <div class="col-md-8">

                {# TITRE & AUTEURS #}
                <h1 class="display-5 fw-bold text-dark mb-2">{{ ouvrage.titre }}</h1>
                <p class="fs-4 text-primary mb-4">
                    {% for auteur in ouvrage.auteurs %}
                        {{ auteur.prenom }} {{ auteur.nom }}{% if not loop.last %}, {% endif %}
                    {% else %}
                        Auteur inconnu
                    {% endfor %}
                </p>

                <hr class="opacity-10 my-4">

                {# TAGS & CATÉGORIES #}
                <div class="mb-4">
                    {% if ouvrage.categories %}
                        <span class="text-uppercase text-secondary fw-bold small ls-1 me-3">Catégories :</span>
                        <span class="badge bg-light text-dark border me-2">{{ ouvrage.categories }}</span>
                    {% endif %}

                    {% if ouvrage.tags %}
                        <div class="mt-2">
                            <span class="text-uppercase text-secondary fw-bold small ls-1 me-3">Tags :</span>
                            <span class="badge bg-light text-dark border">{{ ouvrage.tags }}</span>
                        </div>
                    {% endif %}
                </div>

                {# RÉSUMÉ COMPLET #}
                <h4 class="fw-bold mb-3 mt-5">Résumé</h4>
                <p class="lead text-muted" style="line-height: 1.8; text-align: justify;">
                    {{ ouvrage.resume|default('Aucun résumé disponible pour cet ouvrage.')|nl2br }}
                </p>

                {# DÉTAILS TECHNIQUES #}
                <h4 class="fw-bold mb-3 mt-5">Détails du livre</h4>
                <div class="card bg-light border-0 rounded-3 p-3">
                    <div class="row">
                        <div class="col-6 col-md-4 mb-3">
                            <small class="text-uppercase text-muted fw-bold d-block">Éditeur</small>
                            <span class="fw-semibold">{{ ouvrage.editeur }}</span>
                        </div>
                        <div class="col-6 col-md-4 mb-3">
                            <small class="text-uppercase text-muted fw-bold d-block">Année</small>
                            <span class="fw-semibold">{{ ouvrage.annee }}</span>
                        </div>
                        <div class="col-6 col-md-4 mb-3">
                            <small class="text-uppercase text-muted fw-bold d-block">Langue</small>
                            <span class="fw-semibold">{{ ouvrage.langues }}</span>
                        </div>
                        <div class="col-6 col-md-4 mb-3">
                            <small class="text-uppercase text-muted fw-bold d-block">ISBN</small>
                            <span class="font-monospace text-secondary">{{ ouvrage.ISBN }}</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock %}
